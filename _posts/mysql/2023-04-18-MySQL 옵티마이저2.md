---
layout: post  
title: 옵티마이저  
author: jae-hee Han  
date: 2023-04-18 09:50:00 +09:00  
categories: [MYSQL]  
tags: [mysql, 옵티마이저]  
math: true  
mermaid: true  
image: https://tech.vkein.com/assets/img/mysql.png
path:   
lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA  
alt:
---

## 고급 최적화

옵티마이저 옵션은 조인 관련된 옵티마이저 옵션과 옵티마이저 스위치로 구분

```sql
-- // MySQL 서버 전체적으로 옵티마이저 스위치 설정 
mysql> SET GLOBAL optimizer_switch='index_merge=on,index_merge_union=on,...';

-- // 현재 커넥션의 옵티마이저 스위치만 설정 
mysql> SET SESSION optimizer_switch='index_merge=on,index_merge_union=on,...';
```

SET_VAR 옵티마이저 힌트를 이용해 현재 쿼리에만 설정 가능하다.
```sql
mysql> SELECT /** SET_VAR(optimizer_switch='condition_fanout_filter=off') */
.... from ...
```

### MRR과 배치 키 엑세스 (mrr & batched_key_access)

Multi-Range Read 이라고 함

#### 네스티드 루프 조인 (Nested Loop Join)
기존에 조인 방식은 드라이빙 테이블(조인에서 제일 먼저 읽는 테이블)의 레코드를 한 건 읽어서 드리븐 테이블 일치하는 레코드를 찾아서 조인을 수행

단점 : 조인은 MySQL 엔진이 처리하지만 드리븐 테이블에 데이터 조회는 스토리지 엔진이 수행 아무런 최적화를 수행하지 못함

단점 보안을 위해 조인 대상 테이블 중 하나로 부터 레코드를 읽어서 버퍼링하고 조인 버퍼가 가득 차면 비로서 MySQL 엔진은 스토리지 엔진에 한 번 요청한다. 
이런 방식을 MRR(Multi-Range Read) 라고 한다. 이를 응용한 BKA(Batched Key Access) 조인이 있지만 성능이 좋지 않음


